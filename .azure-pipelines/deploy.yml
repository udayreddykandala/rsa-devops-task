trigger:
- main

pool:
  name: MyAgentPool

stages:
  - stage: Terraform
    displayName: "Terraform Infrastructure"
    jobs:
      - job: TerraformJob
        displayName: "Run Terraform"
        steps:
          - checkout: self

          - task: TerraformInstaller@1
            displayName: Install Terraform
            inputs:
              terraformVersion: '1.5.7'

          - task: TerraformCLI@1
            displayName: Terraform Init
            inputs:
              command: 'init'
              workingDirectory: 'infra'
              backendType: 'azurerm'
              backendServiceArm: 'azure-rm-conn'
              ensureBackend: true

          - task: TerraformCLI@1
            displayName: Terraform Plan
            inputs:
              command: 'plan'
              workingDirectory: 'infra'
              environmentServiceName: 'azure-rm-conn'
